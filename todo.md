# Golden Touch Design - TODO List

## المصادقة والصلاحيات
- [x] تحديث نموذج المستخدمين لدعم 4 أدوار (Admin, Accountant, Project Manager, Designer)
- [x] إنشاء نظام صلاحيات محدد لكل دور

## قاعدة البيانات
- [x] تصميم جداول العملاء (Clients)
- [x] تصميم جداول المشاريع (Projects)
- [x] تصميم جداول الفواتير والعروض (Invoices/Quotes)
- [x] تصميم جداول الاستمارات (Forms)
- [x] تصميم جداول المحاسبة (BOQ, Expenses, Installments)
- [x] تصميم جدول سجل النشاطات (Audit Logs)
- [x] تصميم جداول إعدادات الشركة (Company Settings)
- [x] تطبيق العلاقات بين الجداول

## الواجهات الخلفية (tRPC)
- [x] إنشاء procedures لإدارة العملاء
- [x] إنشاء procedures لإدارة المشاريع
- [x] إنشاء procedures لإدارة الفواتير والعروض
- [x] إنشاء procedures لإدارة الاستمارات
- [x] إنشاء procedures للمحاسبة
- [x] إنشاء procedures لسجل النشاطات
- [x] إنشاء procedures للبحث الشامل
- [x] إنشاء procedures للإعدادات العامة
- [x] إنشاء procedures للإشعارات

## واجهة المستخدم
- [x] تصميم الشريط الجانبي والتنقل الرئيسي
- [x] صفحة لوحة التحكم الرئيسية
- [x] صفحة إدارة العملاء
- [ ] صفحة ملف العميل الموحد
- [x] صفحة إدارة المشاريع
- [ ] صفحة تفاصيل المشروع مع مخطط جانت
- [x] صفحة الفواتير والعروض مع نموذج fatora1.5
- [x] صفحة الاستمارات مع نموذج istmaratalabat2.5
- [ ] صفحة المحاسبة (التكاليف، BOQ، الأقساط)
- [ ] صفحة التقارير المالية والضريبية
- [ ] صفحة سجل النشاطات
- [ ] صفحة الإعدادات العامة
- [ ] صفحة إدارة المستخدمين
- [ ] مكون البحث الشامل

## التكاملات
- [ ] إضافة ميزة Stripe للمدفوعات (يحتاج مفاتيح API من المستخدم)
- [x] تكامل S3 لتخزين الملفات
- [x] نظام الإشعارات التلقائية

## الاختبار والتسليم
- [x] كتابة اختبارات Vitest للـ procedures الرئيسية
- [x] اختبار التطبيق والتأكد من عمل جميع الميزات
- [x] إنشاء نقطة الحفظ الأولى
## إصلاحات
- [x] إصلاح خطأ nested anchor tags في صفحة Dashboard

## مهام جديدة
- [x] إنشاء صفحة المحاسبة بكامل محتوياتها
- [x] إنشاء صفحة سجل النشاطات بكامل محتوياتها
- [x] إنشاء صفحة الإعدادات بكامل محتوياتها
- [x] حذف النماذج القديمة (istmaratalabat2.5.txt, fatora1.5.txt)
- [x] إنشاء نموذج استمارة تفضيلات العملاء (desista.txt) مع الشعار
- [x] إنشاء نموذج فاتورة جديد (disfat.txt) مع الشعار والباركود
- [x] إنشاء نموذج عرض سعر جديد (disfat.txt) مع الشعار والباركود

## مهام جديدة - استبدال النماذج وربطها بقاعدة البيانات
- [x] قراءة وفهم مواصفات disfat-1.txt
- [x] قراءة وفهم مواصفات desista-1.txt
- [x] استبدال نموذج الفاتورة/عرض السعر بالكامل وفقاً لـ disfat-1.txt (نسخة مبسطة مع زر تطوير)
- [x] استبدال نموذج استمارة التفضيلات بالكامل وفقاً لـ desista-1.txt (نسخة مبسطة مع زر تطوير)
- [x] ربط نموذج الفاتورة بقاعدة البيانات (حفظ واسترجاع)
- [x] ربط نموذج الاستمارة بقاعدة البيانات (حفظ واسترجاع)
- [x] اختبار حفظ واسترجاع البيانات

## مهام جديدة - تطوير الأقسام الأربعة الرئيسية

### 1. قاعدة البيانات
- [x] إضافة جداول الموظفين (employees)
- [x] إضافة جداول الحضور والانصراف (attendance)
- [x] إضافة جداول الرواتب (payroll)
- [x] إضافة جداول الإجازات (leaves)
- [x] إضافة جداول تقييم الأداء (performance_reviews)
- [x] إضافة جداول المهام (tasks)
- [x] إضافة جداول الجدولة الزمنية (timelines)
- [x] تحديث جدول المشاريع لدعم المراحل والحالات
- [x] تحديث جدول Audit Logs لدعم جميع الأنواع

### 2. الواجهات الخلفية (tRPC)
- [x] إنشاء procedures لإدارة الموظفين (hr router منفصل)
- [x] إنشاء procedures للحضور والانصراف
- [x] إنشاء procedures للرواتب
- [x] إنشاء procedures للإجازات
- [x] إنشاء procedures لتقييم الأداء
- [ ] إنشاء procedures للمهام
- [ ] إنشاء procedures للجدولة الزمنية
- [x] تحديث procedures المحاسبة (accounting router منفصل)
- [x] تحديث procedures Audit Logs

### 3. قسم المحاسبة المالية
- [ ] تطوير صفحة المصروفات التشغيلية
- [ ] تطوير صفحة BOQ
- [ ] تطوير صفحة دفعات المشاريع
- [ ] تطوير صفحة التقارير المالية
- [ ] تطوير صفحة التقارير الضريبية

### 4. قسم إدارة المشاريع
- [ ] إضافة مكتبة Gantt Chart
- [ ] تطوير صفحة تفاصيل المشروع مع Gantt
- [ ] تطوير نظام إدارة المهام
- [ ] تطوير نظام تتبع المراحل
- [ ] تطوير نظام توزيع المهام على الفريق

### 5. قسم سجلات التتبع
- [ ] تطوير صفحة Audit Logs الشاملة
- [ ] إضافة فلاتر متقدمة (حسب المستخدم، النوع، التاريخ)
- [ ] إضافة تصدير التقارير

### 6. قسم الموارد البشرية
- [x] تطوير صفحة ملفات الموظفين (نسخة أساسية)
- [x] تطوير صفحة الحضور والانصراف (نسخة أساسية)
- [x] تطوير صفحة الرواتب (نسخة أساسية)
- [x] تطوير صفحة الإجازات والموافقات (نسخة أساسية)
- [x] تطوير صفحة تقييم الأداء (نسخة أساسية)
- [x] إنشاء صفحة HR.tsx مع tabs لجميع الأقسام

### 7. الاختبارات
- [x] كتابة اختبارات للـ HR procedures (16 اختبار)
- [x] كتابة اختبارات للـ Accounting procedures (20 اختبار)
- [x] تشغيل جميع الاختبارات (39/44 نجحت)

### 8. التحسينات المطلوبة
- [ ] إنشاء projects router منفصل
- [ ] إضافة نماذج إدخال تفاعلية للموظفين
- [ ] إضافة نماذج إدخال تفاعلية للمصروفات والأقساط
- [ ] تحسين صفحة المحاسبة مع رسوم بيانية


### 9. مخطط جانت (Gantt Chart)
- [x] تثبيت مكتبة gantt-task-react
- [x] إنشاء مكون GanttChart قابل لإعادة الاستخدام
- [x] تحديث صفحة المشاريع لعرض مخطط جانت
- [x] إنشاء صفحة تفاصيل المشروع مع Gantt
- [x] دعم RTL للغة العربية
- [x] إضافة procedure getDetails في projects router
- [x] ربط صفحة Projects بصفحة ProjectDetails
- [x] عرض الإحصائيات المالية في صفحة التفاصيل


### 10. نظام الموارد البشرية الشامل
- [x] تحسين HR router مع procedures متقدمة (getDetails, getSummary, generatePayslip)
- [x] ربط الموظفين بالمستخدمين والأدوار
- [x] صفحة ملفات الموظفين الشاملة (EmployeeProfile.tsx مع 5 tabs)
- [x] نظام حضور وانصراف متقدم مع تتبع ساعات (CheckInDialog)
- [ ] ربط المهام بساعات العمل
- [x] نظام رواتب كامل مع حساب تلقائي
- [x] توليد كشوف رواتب PDF (PayslipPDF component)
- [x] نظام إجازات مع workflow الموافقات (AddLeaveDialog + LeaveApprovalDialog)
- [x] تقييم أداء مرتبط بالمشاريع (AddPerformanceReviewDialog)
- [x] سجلات HR متكاملة مع Audit Log (عبر procedures)
- [x] دمج جميع dialogs في HR.tsx
- [x] AddEmployeeDialog لإضافة موظفين جدد


### 11. تحسينات لوحة التحكم وإظهار الصفحات
- [x] إضافة procedures لإنشاء مستخدمين جدد (users.create)
- [x] إضافة procedures لتحديث أدوار المستخدمين (users.update, users.updateRole)
- [x] إضافة helper functions في db.ts (getUserByEmail, createUser, updateUser)
- [x] إنشاء AddUserDialog
- [x] إنشاء EditUserDialog (لتحرير البيانات والأدوار)
- [x] تحديث Dashboard.tsx مع dialogs وقسم إدارة المستخدمين
- [x] إظهار صفحة Activity Log في الـ sidebar (موجودة بالفعل)
- [x] إظهار صفحة HR في الـ sidebar
- [x] التأكد من عمل navigation لجميع الصفحات


### 12. قسم المبيعات والمشتريات في المحاسبة
- [x] نسخ الشعار والباركود إلى public
- [x] إضافة جدول sales في schema.ts
- [x] إضافة جدول purchases في schema.ts
- [x] تطبيق التغييرات على قاعدة البيانات (pnpm db:push)
- [x] إضافة procedures للمبيعات في accounting router (list, create, getTotalSales)
- [x] إضافة procedures للمشتريات في accounting router (list, create, getTotalPurchases)
- [x] تحديث صفحة Accounting.tsx مع tabs جديدة (5 tabs)
- [ ] إضافة dialogs لإدخال المبيعات والمشتريات

### 13. نموذج كشف راتب احترافي
- [x] تحديث PayslipPDF component مع الشعار (/logo.png)
- [x] إضافة الباركود في أسفل الصفحة (/barcode.jpg)
- [x] إضافة بيانات الشركة الكاملة (الاسم، العنوان، السجل، الضريبة)
- [x] إضافة رقم مستند فريد (PAY-{id}-{year}{month})

### 14. نموذج إضافة مشروع جديد
- [x] إنشاء AddProjectDialog شامل
- [x] إضافة جميع الحقول المطلوبة (clientId, name, description, startDate, endDate, budget, assignedTo)
- [x] ربط النموذج بـ projects.create procedure
- [x] تفعيل النموذج في صفحة Projects


### 15. إصلاحات وتحسينات مطلوبة
#### شؤون الموظفين
- [x] تفعيل زر "كشف راتب جديد" في إدارة الرواتب (AddPayrollDialog)

#### المحاسبة
- [x] إنشاء AddSaleDialog لإضافة عمليات البيع
- [x] إنشاء AddPurchaseDialog لإضافة عمليات الشراء
- [x] إنشاء AddInstallmentDialog لإضافة الأقساط
- [x] ربط جميع dialogs بالأزرار في صفحة المحاسبة

#### المشاريع
- [x] إصلاح صفحة الجدول الزمني (Gantt Chart يعمل بشكل صحيح)
- [x] زر "تقرير المشروع" (ينقل إلى ProjectDetails)
- [x] إنشاء AddTaskDialog لإضافة المهام
- [x] إضافة زر "إضافة مهمة" في صفحة المشروع

#### إدارة العملاء
- [x] إصلاح زر "عرض تفاصيل العميل" (ينقل إلى /clients/:id)
- [x] إضافة خيار حذف عميل (زر حذف مع تأكيد)
- [ ] إنشاء صفحة ClientDetails لعرض تفاصيل العميل (موجودة بالفعل)


### 16. إصلاح الأخطاء المبلغ عنها
- [x] إصلاح خطأ Select.Item في AddSaleDialog (استبدال "" بـ "none")
- [x] إصلاح خطأ Select.Item في AddPurchaseDialog (استبدال "" بـ "none")
- [x] إصلاح خطأ Select.Item في AddTaskDialog (استبدال "" بـ "none")
- [x] إصلاح خطأ الجدول الزمني (فلترة المشاريع بدون تواريخ)
- [x] إنشاء صفحة ClientDetails لعرض تفاصيل العميل مع 3 tabs


### 17. إصلاح أخطاء getTime في Gantt Chart
- [x] إصلاح خطأ getTime في صفحة تفاصيل المشروع (ProjectDetails - فلترة المهام بدون تواريخ)
- [x] إصلاح خطأ getTime في صفحة الجدول الزمني (Projects timeline tab - تم إصلاحه سابقاً)


### 18. رسوم بيانية تفاعلية
- [x] تثبيت Chart.js و react-chartjs-2
- [x] إضافة رسم دائري لتوزيع المشاريع في Dashboard (ProjectsChart)
- [x] إضافة رسم بياني خطي للإيرادات الشهرية في Dashboard (RevenueChart)
- [x] إضافة procedures في dashboard router (projectsByStatus, monthlyRevenue)
- [ ] إضافة رسوم بيانية في صفحة المحاسبة

### 19. نظام التقارير المتقدمة
- [ ] إنشاء صفحة Reports
- [ ] إضافة فلاتر تاريخية متقدمة
- [ ] تصدير Excel للمحاسبة
- [ ] تصدير PDF للتقارير

### 20. نظام الإشعارات الفورية
- [ ] إنشاء NotificationCenter component
- [ ] إضافة عداد الإشعارات في header
- [ ] إضافة إشعارات المواعيد النهائية
- [ ] إضافة إشعارات الأقساط المتأخرة
- [ ] إضافة إشعارات طلبات الإجازات


### 21. إصلاح أخطاء مبلغ عنها
- [x] إصلاح خطأ getTime في Projects timeline (إضافة || [] لـ filter)
- [x] إصلاح خطأ nested anchor tags (إزالة onClick من Card)


### 22. إصلاح خطأ getTime في ProjectDetails
- [x] فلترة المهام التي لا تحتوي على startDate و endDate قبل تحويلها إلى Gantt tasks (إضافة || [])


### 23. إصلاح AddTaskDialog
- [x] إضافة حقول startDate و endDate إلزامية في AddTaskDialog (إضافة required و *)
- [x] التحقق من صحة التواريخ قبل الإرسال (endDate > startDate)


### 24. حل المشكلة الجذرية في إضافة المهام وعرض المشاريع
- [x] جعل startDate و endDate إلزامية في backend schema (إزالة optional)
- [x] إضافة validation قوي في ProjectDetails.tsx لتصفية المهام بدون تواريخ صالحة
- [x] إضافة validation إضافي في GanttChart.tsx لمنع تمرير تواريخ غير صالحة
- [x] حذف المهام الفاسدة من قاعدة البيانات
- [x] عرض رسالة واضحة عندما لا توجد مهام بدلاً من تعطل التطبيق
- [x] تغيير createTask من managerProcedure إلى protectedProcedure للسماح لجميع المستخدمين


### 25. تحسينات إدارة المستخدمين
- [x] إضافة procedure لحذف مستخدم (users.delete)
- [x] إضافة helper function في db.ts (deleteUser)
- [x] إنشاء DeleteUserDialog مع تأكيد
- [x] تحديث EditUserDialog لدعم تحرير جميع البيانات والصلاحيات
- [x] إضافة أزرار حذف وتحرير في جدول المستخدمين في Dashboard
- [x] اختبار جميع الميزات الجديدة


### 26. تعديلات شاملة على النظام
#### حذف الجدول الزمني والمهام
- [x] حذف GanttChart component
- [x] حذف AddTaskDialog component
- [x] حذف projectTasks table من schema
- [x] حذف tasks procedures من routers
- [x] حذف tasks helpers من db.ts
- [x] تحديث ProjectDetails لإزالة عرض المهام

#### إضافة خاصية الحذف
- [ ] إضافة deleteProject procedure وزر حذف في Projects
- [ ] إضافة deleteInvoice procedure وزر حذف في Invoices
- [ ] إضافة deleteForm procedure وزر حذف في Forms
- [ ] إنشاء dialogs تأكيد الحذف لكل نوع

#### تحسينات المحاسبة
- [ ] إضافة حقل status للعمليات المحاسبية (active/cancelled)
- [ ] إضافة cancelTransaction procedure
- [ ] إضافة زر إلغاء لكل عملية محاسبية
- [ ] تحديث حساب الإيرادات والمصروفات لاستبعاد العمليات الملغاة
- [ ] ربط النتائج العلوية بالعمليات الفعلية

#### كشف الراتب
- [ ] فحص Payroll component
- [ ] إصلاح المشاكل أو حذف الميزة إذا كانت معقدة
